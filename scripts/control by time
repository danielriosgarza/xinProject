import schedule
import time
from pioreactor.background_jobs.temperature_automation import start_temperature_automation
from pioreactor.background_jobs.stirring import start_stirring

stirrer = start_stirring(target_rpm=550)
temp = start_temperature_automation("thermostat", target_temperature=30)

def set_temp_30():
    temp.target_temperature = 30
    print("Temp = 30°C")

def set_temp_35():
    temp.target_temperature = 35
    print("Temp = 35°C")

def stop_control():
    temp.disconnected()
    stirrer.disconnected()
    print("temp_control_closed")
    exit()

schedule.every(0).minutes.do(set_temp_30)
schedule.every(30).minutes.do(set_temp_35)
schedule.every(60).minutes.do(stop_control)

while True:
    schedule.run_pending()
    time.sleep(1)
